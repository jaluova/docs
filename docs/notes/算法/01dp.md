---
title: 01 DP
icon: 'material-symbols-light:arrow-range-rounded'
createTime: 2025/07/13 13:35:56
permalink: /algorithm/01DP/
---


## æ¦‚å¿µ

è¿™ç±»é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸€ç»´æ•°ç»„ä¸­ä¾æ¬¡é€‰å–**å‰ååæ ‡æ— å…³çš„**`n`ä¸ªå€¼ï¼Œä¸”å¯ä»¥å°†**å†å²æœ€ä¼˜å€¼æˆ–æ–¹æ¡ˆ**æµ“ç¼©ä¸º**æœ‰é™**çš„çŠ¶æ€ï¼Œåœ¨é™å®šæ¡ä»¶ä¸‹è¾¾åˆ°æœ€ä¼˜å€¼ï¼Œæˆ–ç»Ÿè®¡åœ¨é™åˆ¶æ¡ä»¶ä¸‹åˆæ³•çš„æ–¹æ¡ˆæ•°ã€‚

>1. é€‰æ˜¯1ï¼Œä¸é€‰æ˜¯0
>2. ä¸æ˜¯01èƒŒåŒ…ï¼Œä½†æ˜¯å–åæ€è·¯ç±»ä¼¼ã€‚

## ä¾‹é¢˜

### 1 æœ€é«˜ä¹˜æ³•å¾—åˆ†

>  LeetCode.3290
>  
> ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º 4 çš„æ•´æ•°æ•°ç»„ `a` å’Œä¸€ä¸ªå¤§å° **è‡³å°‘**ä¸º 4 çš„æ•´æ•°æ•°ç»„ `b`ã€‚
> 
> ä½ éœ€è¦ä»æ•°ç»„ `b` ä¸­é€‰æ‹©å››ä¸ªä¸‹æ ‡ `i0`, `i1`, `i2`, å’Œ `i3`ï¼Œå¹¶æ»¡è¶³ `i0 < i1 < i2 < i3`ã€‚ä½ çš„å¾—åˆ†å°†æ˜¯ `a[0] * b[i0] + a[1] * b[i1] + a[2] * b[i2] + a[3] * b[i3]` çš„å€¼ã€‚
> 
> è¿”å›ä½ èƒ½å¤Ÿè·å¾—çš„ **æœ€å¤§** å¾—åˆ†ã€‚

#### åšæ³•

çŠ¶æ€ï¼š$f_{i,k}$ è¡¨ç¤ºå‰ $i$ æ•°ä¸­ï¼Œå·²ç»é€‰æ‹©äº† $k$ ä¸ªæ•°å­—ï¼Œæ‰€è¾¾åˆ°çš„æœ€å¤§å€¼ã€‚

è½¬ç§»ï¼š
- é€‰æ‹©å½“å‰æ•°å­—ä½œä¸ºç¬¬ $k$ ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆå°±ä» $f_{i - 1, k - 1}$ è½¬è¿‡æ¥ã€‚
- ä¸é€‰æ‹©å½“å‰æ•°å­—ï¼Œé‚£ä¹ˆ $f_{i, k}$ å°±æ˜¯ $f_{i - 1, k}$ ã€‚

#### æ–¹ç¨‹
$$
f_{i, k} =
\begin{cases}
0 & k = 0 \\
\max(f_{i - 1, k}, f_{i - 1, k - 1} + b_{i - 1} \cdot a_{k - 1}) & k > 0
 \end{cases}
$$
#### ä»£ç 

```cpp
int n = b.size(), m = a.size();
auto dp = vector(n + 1, vector(m + 1, -1e11));

dp[0][0] = 0;
for (int i = 1; i <= n; ++i) {
  for (int k = 0; k <= m; ++k) {
    dp[i][k] = dp[i - 1][k];
    if (k > 0) dp[i][k] = max(
      dp[i - 1][k], 
      dp[i - 1][k - 1] + 1ll * b[i - 1] * a[k - 1]
    );
  }
}
dout << dp;

cout << dp[n][m] << endl;
```

è¿™é‡Œä¸€å¼€å§‹å†™äº†ä¸€ä¸ªé”™è¯¯çš„çŠ¶æ€è½¬ç§»ï¼ŒåŸå› è¿˜æœ‰éæ³•çŠ¶æ€ $k > i$ ï¼Œéœ€è¦**ç¦æ­¢**è¿™æ¡è½¬ç§» ã€‚
> Wrong Answer
>
>
> [3, 2, 5, 6]
> [2, -6, 4, -5, -3, 2, -7]
> [
>   [0, 0, 0, 0, 0],
>   [0, 6, 4, 10, 12],
>   [0, 6, 4, 10, 12],
>   [0, 12, 14, 24, 34],
>   [0, 12, 14, 24, 34],
>   [0, 12, 14, 24, 34],
>   [0, 12, 16, 24, 36],
>   [0, 12, 16, 24, 36]
> ]
>
>
> Accepted
> [3, 2, 5, 6]
> [2, -6, 4, -5, -3, 2, -7]
> [
>   [0, -INF, -INF, -INF, -INF],
>   [0, 6, -INF, -INF, -INF],
>   [0, 6, -6, -INF, -INF],
>   [0, 12, 14, 14, -INF],
>   [0, 12, 14, 14, -16],
>   [0, 12, 14, 14, -4],
>   [0, 12, 16, 24, 26],
>   [0, 12, 16, 24, 26]
> ]

![](img/æœ€é«˜ä¹˜æ³•.svg)

#### æ·±åº¦æ€è€ƒ

æ³¨æ„åˆ°ï¼Œ $i$ çš„æ‰€æœ‰çŠ¶æ€ï¼Œéƒ½æ˜¯ $i - 1$ è½¬ç§»æ¥çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€åˆ†ä¸º**å½“å‰çŠ¶æ€**å’Œ**å†å²çŠ¶æ€**ã€‚
$$
\rm cur[k] = \max(his[k], his[k - 1] + a[k - 1] \cdot b[i - 1])
$$
==ä¼˜åŠ¿==ï¼š

- ä¸éœ€è¦å…³æ³¨æ•°ç»„ä¸‹æ ‡
- èŠ‚çœå†…å­˜

```cpp
vector<ll> his(m + 1, -1e11);
vector<ll> cur = his;

his[0] = 0;
for (int i = 1; i <= n; ++i) {
  for (int k = 0; k <= min(i, m); ++k) {
    cur[k] = his[k];
    if (k > 0) cur[k] = max(
      his[k],
      his[k - 1] + 1ll * b[i - 1] * a[k - 1]
    );
  }
  dout.sp(to_string(i));
  dout << cur;
  his = cur;
}

cout << cur[m] << endl;
```

### 2 æœ€å¤§çš„å’Œ

> ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæœ‰æ­£æœ‰è´Ÿï¼Œä»»é€‰ä¸€äº›æ•°å­—ï¼Œä½¿å¾—å’Œæœ€å¤§ã€‚

#### åšæ³•

çŠ¶æ€ï¼š$f_i$ è¡¨ç¤ºé€‰åˆ°ç¬¬ $i$ ä¸ªå…ƒç´ æ—¶çš„æœ€å¤§å€¼ã€‚

è½¬ç§»ï¼š
- é€‰å½“å‰å…ƒç´ 
- ä¸é€‰å½“å‰å…ƒç´ 

#### æ–¹ç¨‹

$$
f_i = 
\begin{cases}
\max(0, a_0) & i = 0 \\
\max(f_{i - 1}, f_{i - 1} + a_i) & i > 0
 \end{cases}
$$

#### ä»£ç 

```cpp
vector<int> f(n);
f[0] = max(0, a[0]);
for (int i = 1; i < n; ++i) {
  f[i] = max(f[i - 1], f[i - 1] + a[i]);
}
cout << f[n - 1] << endl;
```

```cpp
int his = 0, cur = 0;
for (int i = 0; i < n; ++i) {
  cur = max(his, his + a[i]);
  his = cur;
}
cout << cur << endl;
```
![](img/æœ€å¤§çš„æ•°.svg)

#### æ·±åº¦æ€è€ƒ

æ˜¯ä¸æ˜¯åªéœ€è¦`his`å°±å¯ä»¥äº†ï¼Ÿ
```cpp
int his = 0;
for (int i = 0; i < n; ++i) {
  his = max(his, his + a[i]);
}
cout << his << endl;
```
### 3 æœ€å¤§çš„ä¹˜ç§¯

 > LeetCode.2708
 > ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæœ‰æ­£æœ‰è´Ÿï¼Œæ„æˆä¸€ä¸ª**éç©º**é›†ï¼Œä½¿å¾—**ä¹˜ç§¯**æœ€å¤§ã€‚ 

#### åšæ³•

å› ä¸ºå­˜åœ¨**è´Ÿè´Ÿå¾—æ­£**çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å•çº¯çš„å–æ­£æ•°ã€‚

çŠ¶æ€ï¼š$f_{i,0/1}$ ï¼Œè‹¥åªé€‰å–å‰ $i$ ä¸ªæ•°å­—ï¼Œ$0$ è¡¨ç¤ºæœ€å°å€¼ï¼Œ$1$ è¡¨ç¤ºæœ€å¤§å€¼ã€‚

è½¬ç§»ï¼š
- é€‰å–å½“å‰æ•°å­—
- ä¸é€‰å½“å‰æ•°å­—
- èˆå¼ƒä¹‹å‰é€‰æ‹©

![](img/æœ€å¤§ä¹˜ç§¯.svg)

#### æ–¹ç¨‹

$$
\begin{align}
& f_{0, 0} = f_{0, 1} = a[0] \\
& f_{i + 1, 0} = \max(x, f_{i, 0}, f_{i, 1} \cdot x, f_{i, 0} \cdot x) \\
& f_{i + 1, 1} = \max(x, f_{i, 1}, f_{i, 1} \cdot x, f_{i, 0} \cdot x) \\

\end{align}
$$
#### ä»£ç 

```cpp
auto f = vector(n, vector<ll>(2, 0));
f[0][1] = f[0][0] = a[0];
for (int i = 0; i + 1 < n; ++i) {
  f[i + 1][1] = max({
    f[i][1],
    f[i][1] * a[i + 1],
    f[i][0] * a[i + 1],
    1ll * a[i + 1],
  });

  f[i + 1][0] = min({
    f[i][0],
    f[i][0] * a[i + 1],
    f[i][1] * a[i + 1],
    1ll * a[i + 1],
  });
}
```

```cpp
vector<ll> his(2), cur(2);
his[0] = his[1] = a[0];
for (int i = 0; i + 1 < n; ++i) {
  ll x = a[i + 1];
  cur[1] = max({his[1], his[1] * x, his[0] * x, x});
  cur[0] = min({his[0], his[1] * x, his[0] * x, x});
  his = cur;
}

cout << his[1] << endl;
```

### 4 æœ€å¤§äº¤æ›¿å­åºåˆ—å’Œ

> ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæœ‰æ­£æœ‰è´Ÿï¼Œä»ä¸­é€‰ä¸€äº›æ•°å­—ç»„æˆæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„çš„æƒå€¼ç­‰äºå¥‡æ•°ä½å’Œå‡å¶æ•°ä½å’Œï¼Œæ±‚æœ€å¤§æƒå€¼ã€‚

#### åšæ³•

çŠ¶æ€ï¼š$f_{i,0/1}$ ï¼Œè‹¥åªé€‰å–å‰ $i$ ä¸ªæ•°å­—ï¼Œ$0$ è¡¨ç¤ºæœ€å°å€¼ï¼Œ$1$ è¡¨ç¤ºæœ€å¤§å€¼ã€‚

è½¬ç§»ï¼š
- é€‰å–å½“å‰æ•°å­—
- ä¸é€‰å½“å‰æ•°å­—
- èˆå¼ƒä¹‹å‰é€‰æ‹©
![[æœ€å¤§äº¤æ›¿å­åºåˆ—å’Œ.svg]]

å¦‚ä½•è½¬ç§»ï¼šåè½¬å‰é¢çš„ç»“æœï¼ŒåŠ ä¸Šå½“å‰æ•°å­—ã€‚

#### æ–¹ç¨‹

$$
f_{i, 0/1} = \min(x - f_{i, 0}, x - f_{i, 1}, f_{i, 0/1}, x);
$$
#### ä»£ç 

```cpp
vector<ll> his(2), cur(2);
his[0] = his[1] = a[0];
for (int i = 0; i + 1 < n; ++i) {
  ll x = a[i + 1];
  cur[1] = max({his[1], x - his[1], x - his[0], x});
  cur[0] = min({his[0], x - his[1], x - his[0], x});
  his = cur;
}

cout << his[1] << endl;
```

### ä¸åŒçš„å­åºåˆ—

> ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²Â `s`Â å’ŒÂ `t`Â ï¼Œç»Ÿè®¡å¹¶è¿”å›åœ¨Â `s`Â çš„Â **å­åºåˆ—**Â ä¸­Â `t`Â å‡ºç°çš„ä¸ªæ•°ã€‚
#### åšæ³•

çŠ¶æ€ï¼š$f_{i, k}$ ä»£è¡¨åªåœ¨å‰ $i$ ä¸ªå­—ç¬¦ä¸­é€‰ï¼Œå·²ç»é€‰äº† $k$ ä¸ªçš„æ–¹æ¡ˆæ•°ã€‚

è½¬ç§»ï¼š
- è‹¥å¯ä»¥é€‰æ‹©ï¼Œåˆ™é€‰æ‹©å½“å‰å­—ç¬¦
- ä¸é€‰æ‹©å½“å‰å­—ç¬¦

![](img/ä¸åŒçš„å­åºåˆ—.svg)

#### æ–¹ç¨‹

$$
\begin{align}
& if \ s_{i - 1} = t_{k - 1} & add(f_{i + 1,k + 1}, f_{i, k}) \\
& else  & add(f_{i + 1, k}, f_{i, k})
\end{align}
$$

#### ä»£ç 

```cpp
auto dp = vector(n + 1, vector(m + 1, 0ull));

dp[0][0] = 1;
for (int i = 1; i <= n; ++i) {
  for (int k = 0; k <= m; ++k) {
    if (k && s[i - 1] == t[k - 1]) {
      dp[i][k] += dp[i - 1][k - 1];
    }
    dp[i][k] += dp[i - 1][k];
  }
}
cout << dp[n][m] << endl;
```

```cpp
vector<uint32_t> his(m + 1), cur(m + 1);
his[0] = 1;
for (int i = 1; i <= n; ++i) {
    fill(cur.begin(), cur.end(), 0);
    for (int k = 0; k <= m; ++k) {
        if (k && s[i - 1] == t[k - 1]) {
            cur[k] += his[k - 1];
        }
        cur[k] += his[k];
    }
    his = cur;
}
cout << his[m] << endl;
```

#### æ·±åº¦æ€è€ƒ

1. å› ä¸º $k < i$ ï¼Œå¯å‡å°‘æšä¸¾æ¬¡æ•°
2. å¯ä»¥ä»åå¾€å‰æ›´æ–°ï¼Œä»¥èŠ‚çœå†…å­˜ã€‚

```cpp
vector<uint32_t> his(m + 1);
his[0] = 1;
for (int i = 1; i <= n; ++i) {
  for (int k = min(i, m); k >= 1; --k) {
    if (s[i - 1] == t[k - 1]) {
      his[k] += his[k - 1];
    }
  }
}
cout << his[m] << endl;
```

### ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œå…¶ä¸­ `prices[i]` æ˜¯æŸæ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚
>
> è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ `k` ç¬”äº¤æ˜“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æœ€å¤šå¯ä»¥ä¹° `k` æ¬¡ï¼Œå– `k` æ¬¡ã€‚
>
> **æ³¨æ„ï¼š** ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

#### åšæ³•

çŠ¶æ€ï¼š

è½¬ç§»ï¼š

![](img/ä¹°å–è‚¡ç¥¨.svg)


#### ä»£ç 

```cpp
int n = a.size();
auto dp = vector(k + 1, vector<int>(2, -1e9));

dp[0][0] = 0;
for (int i = 0; i < n; ++i) {
  for (int j = k; j >= 0; --j) {
    dp[j][1] = max({
      dp[j][0] - a[i],
      dp[j][1],
    });
    if (j == 0) continue;
    dp[j][0] = max({
      dp[j - 1][1] + a[i],
      dp[j][0],
    }); 
  }
}

int ans = 0;
for (int i = 1; i <= k; ++i) { 
  ans = max(ans, dp[i][0]);
}
cout << ans << endl;
```

## æ€»ç»“

1. **ä½ç½®æ— å…³**çš„ä»æ•°ç»„ä¸­é€‰å–ä¸€ä¸ªé›†åˆã€‚
2. å¯ä»¥å°†å†å²æœ€ä¼˜å€¼**æµ“ç¼©ä¸ºæœ‰é™ä¸ªæ•°çš„çŠ¶æ€**ã€‚
3. å¯æ ¹æ®è½¬ç§»ç‰¹æ€§ä¼˜åŒ–å†…å­˜ç©ºé—´ï¼ˆè½¬ç§»ä¸äº¤å‰ï¼‰ã€‚


## æ ‘

é“¾æ¥ğŸ”—ï¼š[P12844 è“æ¡¥æ¯ 2025 å›½ A æ ‘](https://www.luogu.com.cn/problem/P12844)
![](img/å›½A%20æ ‘.svg)

å°è¯•01DPï¼Œä»å­æ ‘æ›´æ–°ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  const int mod = 998244353;
  const int N = 3e5 + 5;
  int n; cin >> n;
  auto adj = vector(n + 1, vector<int>());
  auto dp = vector(n + 1, vector<ll>(2));
  for (int i = 0 ; i < n - 1; ++i) {
    int u, v; cin >> u >> v;
    adj[u].push_back(v);
    adj[v].push_back(u);
  }

  vector<ll> pre(N), suf(N);
  function<void(int, int)> dfs = [&](int u, int f) {
    dp[u][1] = 1;

    for (auto v : adj[u]) {
      if (v == f) continue;
      dfs(v, u);
    }

    for (auto v : adj[u]) {
      if (v == f) continue;
      for (auto w : adj[v]) {
        if (w == u) continue;
        (dp[u][1] *= dp[w][0]) %= mod;
      }
    }

    int cnt = 0;
    for (auto v : adj[u]) {
      if (v == f) continue;
      cnt++;
      pre[cnt] = suf[cnt] = dp[v][0];
    }
    pre[0] = suf[cnt + 1] = 1;
    for (int i = 1; i <= cnt; ++i) {
      (pre[i] *= pre[i - 1]) %= mod;
    }
    for (int i = cnt; i >= 1; --i) {
      (suf[i] *= suf[i + 1]) %= mod;
    }
    dp[u][0] = pre[cnt];
    int k = 0;
    for (auto v : adj[u]) {
      if (v == f) continue;
      k++;
      (dp[u][0] += dp[v][1] * pre[k - 1] % mod * suf[k + 1] % mod) %= mod;
    }
  };

  dfs(1, 0);
  cout << (dp[1][0] + dp[1][1] + mod - 1) % mod;
}
```

## æ•°ç»„åˆ†å‰²

é“¾æ¥ğŸ”—ï¼š[P12325 è“æ¡¥æ¯ 2023 çœ Java B æ•°ç»„åˆ†å‰²](https://www.luogu.com.cn/problem/P12325)

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  const int mod = 1e9 + 7;
  int T; cin >> T;
  while (T--) {
    int n; cin >> n;
    vector<int> a(n);
    ll sum = 0;
    for (auto &x : a) {
      cin >> x; 
      sum += x;
    }
    if (sum % 2 == 1) {
      cout << "0\n";
      continue;
    }
    auto dp = vector(n, vector<ll>(2));
    dp[0][a[0] % 2]++;
    for (int i = 1; i < n; ++i) {
      dp[i][1] = dp[i - 1][1];
      dp[i][0] = dp[i - 1][0];
      if (a[i] % 2 == 1) {
        (dp[i][1] += dp[i - 1][0] + 1) %= mod;
        (dp[i][0] += dp[i - 1][1]) %= mod;
      } else {
        (dp[i][0] += dp[i - 1][0] + 1) %= mod;
        (dp[i][1] += dp[i - 1][1]) %= mod;
      }
    }
    dout << dp;
    cout << dp[n - 1][0] + 1 << '\n';
  }
}
```

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  const int mod = 1e9 + 7;
  int T; cin >> T;
  while (T--) {
    int n; cin >> n;
    vector<int> a(n);
    ll sum = 0;
    for (auto &x : a) {
      cin >> x; 
      sum += x;
    }
    if (sum % 2 == 1) {
      cout << "0\n";
      continue;
    }
    vector<int> dp(2);
    auto upd = [&](int& a, int& b, int c, int d) {
      (a += c) %= mod;
      (b += d) %= mod;
    };
    dp[a[0] % 2]++;
    for (int i = 1; i < n; ++i) {
      if (a[i] % 2 == 1) {
        upd(dp[0], dp[1], dp[1], dp[0] + 1);
      } else {
        upd(dp[0], dp[1], dp[0] + 1, dp[1]);
      }
    }
    cout << dp[0] + 1 << '\n';
  }
}
```

## æ¥é¾™æ•°åˆ—

 é“¾æ¥ğŸ”—ï¼š[P9242 è“æ¡¥æ¯ 2023 çœ B æ¥é¾™æ•°åˆ—](https://www.luogu.com.cn/problem/P9242)

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  int n; cin >> n;
  string s;
  vector<ll> dp(10);
  for (int i = 0; i < n; ++i) {
    cin >> s;
    int frt = s.front() - '0';
    int bck = s.back() - '0';
    dp[bck] = max(dp[frt] + 1, dp[bck]);
  }
  
  cout << n - *max_element(all(dp));
}
```

## é­”æ³•å·¡æ¸¸

 é“¾æ¥ğŸ”—ï¼š[P11004 è“æ¡¥æ¯ 2024 çœ Python B é­”æ³•å·¡æ¸¸](https://www.luogu.com.cn/problem/P11004)

æ´›è°·ç‰ˆæœ¬ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  int n; cin >> n;
  vector<int> s(n), t(n);
  for (int i = 0; i < n; ++i) cin >> s[i];
  for (int i = 0; i < n; ++i) cin >> t[i];

  vector<int> cur(2), his(2);
  auto udp = [&](int p, const auto& v) {
    for (int i = 0; i < 3; ++i) if (v[i]) {
      cur[p] = max(his[1 - p] + 1, cur[p]);
      if (p && cur[p] == 1) cur[p] = 0;
      break;
    }
  };
  auto chk = [&](int num, auto& v) {
    for (int x = num; ; x /= 10) {
      if (v[0] * v[1] * v[2]) break;
      if (x == 0) break;
      int y = x % 10;
      if (y == 0|| y == 2|| y == 4) v[y / 2] = true;
    }
  };
  for (int i = 0; i < n; ++i) {
    vector<int> vs(3), vt(3);
    chk(s[i], vs), chk(t[i], vt);
    udp(0, vs), udp(1, vt);
    his = cur;
  }
  cout << *max_element(all(his));
}
```

è“æ¡¥æ¯ç‰ˆæœ¬ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
  cin.tie(0)->sync_with_stdio(0);
  int n; cin >> n;
  vector<int> s(n), t(n);
  for (int i = 0; i < n; ++i) cin >> s[i];
  for (int i = 0; i < n; ++i) cin >> t[i];

  auto cur = vector(2, vector<ll>(3));
  auto his = vector(2, vector<ll>(3));
  auto udp = [&](int p, const auto& v) {
    for (int j = 0; j < 3; ++j) if (v[j]) {
      for (int k = 0; k < 3; ++k) if (v[k]) {
        cur[p][k] = max(his[1 - p][j] + 1, cur[p][k]);
        if (p && cur[p][k] == 1) cur[p][k] = 0; 
      }
    }
  };
  auto chk = [&](int num, auto& v) {
    for (int x = num; ; x /= 10) {
      if (v[0] * v[1] * v[2]) break;
      if (x == 0) break;
      int y = x % 10;
      if (y == 0|| y == 2|| y == 4) v[y / 2] = true;
    }
  };
  for (int i = 0; i < n; ++i) {
    vector<int> vs(3), vt(3);
    chk(s[i], vs), chk(t[i], vt);
    udp(0, vs), udp(1, vt);
    his = cur;
  }
  cout << max(*max_element(all(his[0])), *max_element(all(his[1])));
}
```
