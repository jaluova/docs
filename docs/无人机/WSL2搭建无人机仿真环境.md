---
title: WSL2æ­å»ºæ— äººæœºä»¿çœŸç¯å¢ƒ
createTime: 2025/02/16 12:06:08
tags:
    - ROS
    - WSL
    - Ubuntu
    - PX4
permalink: /article/0dikfl77/
---

## å¯ç”¨WSLæœåŠ¡

### ä»€ä¹ˆæ˜¯WSLï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ

@[bilibili](BV1tW42197za)

æˆ‘ä»¬å°†åŸºäºè§†é¢‘ä¸­ä»‹ç»çš„å‡ ç‚¹`ä¾¿åˆ©åŠŸèƒ½`ï¼Œæ­å»ºæ— äººæœºä»¿çœŸç¯å¢ƒ

### ä¸‹è½½Ubuntu

æ ¹æ®è§†é¢‘ä¸­çš„æµç¨‹==å¼€å¯windowsç³»ç»Ÿçš„WSLæœåŠ¡==

æ¥ç€ï¼Œæˆ‘ä»¬ä¸‹è½½==Ubuntu20.04ç‰ˆæœ¬==ï¼ˆä¹‹åä¼šè§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç‰ˆæœ¬ï¼‰

```sh
wsl --install Ubuntu-20.04 --web-download
```

> [!tip]
> å¦‚æœå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼Œå¯ä»¥ä¸‹è½½[Watt Toolkit](https://steampp.net/)å°è¯•åŠ é€Ÿ
> ![](img/1.png)

### åŸºæœ¬é…ç½®

#### ==é»˜è®¤ç”¨æˆ·é…ç½®==

å› ä¸ºæˆ‘ä»¬ä¹‹åä¼šè¿›è¡Œå¤§é‡`import`å’Œ`export`çš„å¤‡ä»½æ“ä½œï¼Œè€Œåœ¨è¿˜åŸå¤‡ä»½æ–‡ä»¶æ—¶ï¼Œä¼šé»˜è®¤ä¸º`root`ç”¨æˆ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦==å°†é»˜è®¤ç”¨æˆ·ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ç”¨æˆ·==

```sh
sudo vim /etc/wsl.conf
```
è¿™é‡Œä½¿ç”¨`vim`å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¾‘ï¼Œåˆæ¬¡ä½¿ç”¨å¯èƒ½ä¼šæ„Ÿè§‰æœ‰ç‚¹`åäººç±»ğŸ˜°`

é¦–å…ˆï¼ŒæŒ‰`i`è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆå·¦ä¸‹è§’å‡ºç°`INSERT`ï¼‰

ç„¶åï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹

```
[user]
default=ä½ çš„ç”¨æˆ·å
```
æœ€åï¼ŒæŒ‰`ESC`é€€å‡º`INSERT`æ¨¡å¼ï¼ŒæŒ‰`:wq`æ¥ä¿å­˜é€€å‡ºvim

> [!tip]
> æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥é€šè¿‡ä»¥ä¸‹è§†é¢‘å­¦ä¹ vimçš„åŸºæœ¬ç”¨æ³•
> @[bilibili](BV13t4y1t7Wg)

#### æ˜¾ç¤ºä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

> [!warning]
> æ­¤æ­¥è®¾ç½®ä»…ä¾›å‚è€ƒï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦æ‰§è¡Œï¼Œå› ä¸ºæˆ‘åæ¥å‘ç°äº†ä¸€äº›æ˜¾ç¤ºä¸Šçš„æ¶æ€§bug

å› ä¸ºæˆ‘ä»¬ä¹‹åä¼šç”¨åˆ°gazeboçš„å›¾å½¢åŒ–çª—å£ï¼Œå¯èƒ½ä¼šå‡ºç°å­—ä½“å¤ªå°ç­‰é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥è§£å†³


```sh
vim ~/.bashrc
```
æŒ‰ä½`shift+g`æˆ–è€…`å¤§å†™çš„G`å°±å¯ä»¥è·³è½¬åˆ°æ–‡ä»¶åº•éƒ¨ï¼Œåœ¨åº•éƒ¨æ·»åŠ 

```
# >>> zoom application windows >>>
export QT_QPA_PLATFORM="wayland;xcb"
export QT_AUTO_SCREEN_SCALE_FACTOR=0
export QT_ENABLE_HIGHDPI_SCALING=0
export QT_SCALE_FACTOR=1.5 # æ­¤å¤„è°ƒèŠ‚ç¼©æ”¾æ¯”ä¾‹
# <<< zoom application windows <<<
```
é€€å‡º`vim`ï¼Œå¹¶è¾“å…¥ä»¥ä½¿å¾—åˆšåˆšçš„ä¿®æ”¹ç”Ÿæ•ˆ
```sh
source ~/.bashrc
```
> [!tip]
> .bashrcæ˜¯bashç»ˆç«¯çš„é…ç½®æ–‡ä»¶ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæœç´¢


#### ==vs codeæœåŠ¡ï¼ˆååˆ†é‡è¦ï¼ï¼‰==

ä½¿ç”¨vimæ˜¯ä¸æ˜¯è¿˜æŒºéº»çƒ¦çš„ï¼Ÿå…¶å®æˆ‘ä»¬å¯ä»¥ç”¨windowsä¸Šçš„`vs code`æ¥ä¿®æ”¹æ–‡ä»¶ï¼ˆä¸ºä»€ä¹ˆä¸æ—©è¯´ğŸ˜¢ï¼‰

é¦–å…ˆï¼Œåœ¨vs codeä¸Šæ‰¾åˆ°`WSL`æ’ä»¶å¹¶ä¸‹è½½ï¼Œå¯ç”¨

æ¥ç€ï¼Œåªéœ€è¦åœ¨ç»ˆç«¯è¾“å…¥

```sh
code
```
ç­‰å¾…ä¸‹è½½å®Œæˆå°±å¯ä»¥äº†ï¼

## å®‰è£…ROS

**æ­£ç‰‡å¼€å§‹ï¼**

æˆ‘ä»¬ä½¿ç”¨å°é±¼ROSä¸€é”®å®‰è£…ï¼ŒåŸå› å°±æ˜¯è¿™ä¸ªè„šæœ¬å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®ç½‘ç»œç¯å¢ƒï¼Œæ‰¾åˆ°åˆé€‚çš„ç‰ˆæœ¬ï¼Œå®‰å¿ƒçœäº‹ï¼

```sh
wget http://fishros.com/install -O fishros
```
è¿™ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸‹è½½åˆ°å®‰è£…è„šæœ¬

è¿è¡Œè„šæœ¬

```sh
. fishros
```

æ¥ç€æˆ‘ä»¬è·Ÿç€å¼•å¯¼ï¼Œé€‰æ‹©å®‰è£…ROSï¼Œç”±äºæˆ‘ä»¬è¿˜æ²¡æ¢æºï¼Œå¯ä»¥é€‰æ‹©æ¢æº

æ¥ç€æˆ‘ä¹ˆé€‰æ‹©==å®‰è£…ROS1 noeticçš„æ¡Œé¢ç‰ˆ==ï¼Œå› ä¸ºæˆ‘å‘ç°ç½‘ä¸Šæœ‰å…³ROS1çš„æ•™ç¨‹ä¼šæ›´å¤šä¸€äº›ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä½•é€‰æ‹©Ubuntu20.04çš„åŸå› ï¼‰

å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªç»ˆç«¯ï¼Œè¾“å…¥`roscore`æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ

![](img/2.png)

æ£€æŸ¥å®Œæ¯•ï¼ŒæŒ‰ä½`ctrl+C`å¯ä»¥ç»“æŸè¿›ç¨‹

> [!tip]
> æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å°é±¼è„šæœ¬å®‰è£…rosdepï¼ˆå¯é€‰ï¼‰

## å®‰è£…MAVROS

MAVROSæ˜¯ä¸€ä¸ªROSè½¯ä»¶åŒ…ï¼Œæœ‰äº†å®ƒå°±å¯ä»¥è®©ROSä¸é£æ§é€šä¿¡ã€‚

```sh
sudo apt install ros-$ROS_DISTRO-mavros ros-$ROS_DISTRO-mavros-extras
```

```sh
git clone https://gitee.com/tyx6/geographiclib_datasets_tools.git
cd geographiclib_datasets_tools/
chmod a+x ./install_geographiclib_datasets.sh
sudo ./install_geographiclib_datasets.sh
```

ä¸‹è½½å®Œæˆåè¾“å…¥`roscd mavros`ï¼Œå¦‚æœå‘ç°è·³è½¬åˆ°äº†`/opt/ros/noetic/share/mavros`ç›®å½•ï¼Œå³ä»£è¡¨å®‰è£…æˆåŠŸ

## ä¸‹è½½QGroundControl

å‰å¾€å®˜ç½‘[QGroundControl](https://qgroundcontrol.com/)ï¼Œä¸‹è½½windowsç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä¸æˆ‘ä»¬çš„linuxå­ç³»ç»Ÿæ­å»ºçš„ä»¿çœŸç¯å¢ƒè”é€šï¼

å®‰è£…windowsç‰ˆæœ¬çš„è¿‡ç¨‹ï¼Œç±»ä¼¼äºwindowsä¸Šä¸‹è½½å…¶ä»–åº”ç”¨çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸èµ˜è¿°äº†

è¿™é‡Œæ¨èå¯ç”¨è™šæ‹Ÿæ‰‹æŸ„ï¼Œæ–¹ä¾¿æ§åˆ¶

![](img/8.png)

## å…‹éš†PX4ä»“åº“

### æ–¹æ³•1ï¼šä»githubä¸Šå…‹éš†æºä»£ç ï¼ˆä¸æ¨èï¼‰

```sh
git clone https://github.com/PX4/PX4-Autopilot.git # ä¸‹è½½æºç 
mv PX4-Autopilot PX4_Firmware  # æ›´æ”¹ç›®å½•å
```
```sh
cd PX4_Firmware
git checkout -b dev v1.13.2  # åˆ‡æ¢ç‰ˆæœ¬
git submodule update --init --recursive   # æ›´æ–°ä¸‹è½½å­æ¨¡å—
# æ¯”è¾ƒæ…¢ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨é•œåƒæº
```

### æ–¹æ³•2ï¼šä½¿ç”¨ç½‘ç›˜æˆ–è€…ä»QQç¾¤ä¸‹è½½

```sh
# åœ¨windowsä¸Šçš„ä¸‹è½½è·¯å¾„æ˜¯ä»¥æŒ‚è½½å·çš„å½¢å¼
mv ä¸‹è½½çš„è·¯å¾„/PX4_Firmware_v1.13.2.zip ~ # ç§»åŠ¨åˆ°linuxçš„å·¥ä½œç›®å½•é‡Œ
# å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä»èµ„æºç®¡ç†å™¨ä¸­æ‹–è¿‡å»
sudo apt install unzip # ä¸‹è½½è§£å‹å·¥å…·
unzip PX4_Firmware_v1.13.2.zip
```

è§£å‹å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œæ·»åŠ å¯æ‰§è¡Œè„šæœ¬

```sh
rm PX4_Firmware_v1.13.2.zip # å¯ä»¥åˆ é™¤å‹ç¼©åŒ…
cd PX4_Firmware
wget https://gitee.com/tyx6/mytools/raw/main/px4/set_executable.sh
chmod +x set_executable.sh  # è®¾ç½®æƒé™
./set_executable.sh         # æ‰§è¡Œ
```

## å®‰è£…ç›¸å…³ä¾èµ–å’Œgazebo

```sh
cd ~/PX4_Firmware/Tools/setup
chmod +x ubuntu.sh
./ubuntu.sh --no-nuttx 
# è„šæœ¬æ‰§è¡Œæ—¶é—´ï¼Œè·Ÿä¸ªäººç½‘ç»œæœ‰å…³ï¼Œå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´
```
> [!tip]
> è¿™æ˜¯å®˜æ–¹æä¾›çš„è„šæœ¬ï¼Œæœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°
>
> `--no-sim-tools`   ä¸å®‰è£…ä»¿çœŸç¯å¢ƒ
>
> `--no-nuttx`   ä¸å®‰è£…äº¤å‰ç¼–è¯‘ç¯å¢ƒ
>
> å¦‚æœéœ€è¦è‡ªå·±ç¼–è¯‘é£æ§å›ºä»¶ï¼Œçƒ§å½•åˆ°é£æ§ä¸­ï¼Œé‚£å°±éœ€è¦äº¤å‰ç¼–è¯‘ç¯å¢ƒ

```sh
sudo apt update && sudo apt upgrade
sudo apt-get install ros-$ROS_DISTRO-gazebo-ros-pkgs ros-$ROS_DISTRO-gazebo-ros-control
```

å®‰è£…å¥½åï¼Œè¾“å…¥`gazebo`éªŒè¯æ˜¯å¦å®‰è£…å®Œæˆ
![](img/3.png)

## ç¼–è¯‘æ— äººæœºä»¿çœŸç¯å¢ƒ

```sh
cd ~/PX4_Firmware
make px4_sitl_default gazebo   # è¿™æ­¥å¯èƒ½æœ‰ç‚¹æ…¢ï¼Œè·Ÿç”µè„‘é…ç½®æœ‰å…³
```
![](img/4.png)

## æµ‹è¯•

ç¼–è¾‘`.bashrc`

```sh
code ~/.bashrc
```
æ·»åŠ 
```
# >>> PX4_Firmware >>>
# source ~/catkin_ws/devel/setup.bash  # è¿™ä¸ªæ˜¯ä¸ªäººçš„ROSå·¥ä½œç©ºé—´ï¼Œæˆ‘ä»¬ä¹‹åå¯ä»¥åˆ›å»º
source ~/PX4_Firmware/Tools/setup_gazebo.bash ~/PX4_Firmware/ ~/PX4_Firmware/build/px4_sitl_default
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:~/PX4_Firmware
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:~/PX4_Firmware/Tools/sitl_gazebo
# <<< PX4_Firmware <<<
```

ä¿å­˜é€€å‡ºå¹¶`source ~/.bashrc`

åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€æ®µç±»ä¼¼äºè¿™æ ·çš„æ˜¾ç¤ºå†…å®¹

![](img/5.png)

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥==åœ¨ä»»ä½•ç›®å½•ä¸‹ï¼Œå¯ç”¨ä»¿çœŸç¯å¢ƒ==ï¼Œè¾“å…¥

```sh
roslaunch px4 mavros_posix_sitl.launch
```

![](img/6.png)


æ¥ç€æ–°å»ºä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼ŒæŸ¥çœ‹MAVROSä¸ä»¿çœŸæ— äººæœºé€šä¿¡çŠ¶å†µ

```sh
rostopic echo /mavros/state | grep connected    # åªæŸ¥çœ‹ connected ä¿¡æ¯
```
![](img/7.png)

æˆ‘ä»¬è¿˜å¯ä»¥æ‰“å¼€QGCåœ°é¢ç«™æ¥å¯¹æ— äººæœºè¿›è¡Œæ“æ§

![](img/9.png)

## æ€»ç»“ & å‚è€ƒæ–‡ç« 

OKğŸ˜Šï¼åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„æ— äººæœºä»¿çœŸç¯å¢ƒå°±åŸºæœ¬é…ç½®å®Œæˆäº†ã€‚æˆ‘è¿™ç¯‡æ–‡ç« ä¸»è¦å‚è€ƒçš„æ˜¯[(æœ€æ–°)ubuntuæ­å»ºPX4æ— äººæœºä»¿çœŸç¯å¢ƒ(4) â€”â€”ä»¿çœŸç¯å¢ƒæ­å»º(ä»¥Ubuntu 18.04,ROS1 Melodic ä¸ºä¾‹)](https://blog.csdn.net/weixin_55944949/article/details/130895608)ï¼Œä¹Ÿåˆ©ç”¨äº†ä¸å°‘ç›¸å…³èµ„æºï¼Œåœ¨æ­¤è¡¨ç¤ºéå¸¸æ„Ÿè°¢ï¼ï¼

å¦‚æœåœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ï¼Œè¯·åŠæ—¶åœ¨åº•éƒ¨è¯„è®ºåŒºç•™è¨€ã€‚